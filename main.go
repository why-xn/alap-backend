package main

import (
	"github.com/why-xn/alap-backend/pkg/config"
	"github.com/why-xn/alap-backend/pkg/core/keycloak"
	"github.com/why-xn/alap-backend/pkg/core/log"
	"github.com/why-xn/alap-backend/pkg/db"
	"github.com/why-xn/alap-backend/pkg/server"
)

func main() {

	// Initialize Zap logger
	log.InitializeLogger()

	// Load Environment Variables
	config.InitEnvironmentVariables()

	keycloak.InitKeycloakClient()

	// Init Db Manager
	db.GetDbManager()

	//_, claims := keycloak.DecodeAccessToken("eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI1bGF4RjI0SG56RnRWcmEtQWs2WG1YY2JRV1BweEsxMnFWSnhqbmRiYmhNIn0.eyJleHAiOjE2OTkxMzI1MTIsImlhdCI6MTY5OTEzMjIxMiwiYXV0aF90aW1lIjoxNjk5MTMyMTgzLCJqdGkiOiI4MGY2NzAwOC1jOGIxLTRiYmYtYTEyMC0wMTA3MTAwNTEzY2IiLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvcmVhbG1zL2xvZ2ktY2xvdWQiLCJhdWQiOiJhY2NvdW50Iiwic3ViIjoiODY5YzZmN2QtYzdmYi00M2M5LTk4NWQtOTJiOGUyMTFlNDNmIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoic3NvLWFwcCIsInNlc3Npb25fc3RhdGUiOiI0OWE5ZDFiMS05MzM1LTRkODUtOTUzNC0zOGY2Yzk5ODBiODIiLCJhY3IiOiIxIiwiYWxsb3dlZC1vcmlnaW5zIjpbIioiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwiZGVmYXVsdC1yb2xlcy1sb2dpLWNsb3VkIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX0sInNzby1hcHAiOnsicm9sZXMiOlsicm9sZS11c2VyIl19fSwic2NvcGUiOiJvcGVuaWQgZW1haWwgcHJvZmlsZSIsInNpZCI6IjQ5YTlkMWIxLTkzMzUtNGQ4NS05NTM0LTM4ZjZjOTk4MGI4MiIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoiU2hpaGFiIEhhc2FuIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2hpaGFiIiwiZ2l2ZW5fbmFtZSI6IlNoaWhhYiIsImZhbWlseV9uYW1lIjoiSGFzYW4iLCJlbWFpbCI6InNoaWhhYi5oYXNhbkBsb2dpLWNsb3VkLmNvbSJ9.qsuySdTKx0nuklU2WEOE7eNU4K3ba783Y9tX6IT38o3voSZril6snO-shZImH4j3Aw6JrxAwV-sfjQeij3p0EfbaBYu5ChsD8Fc1IFvJAZz4fyLBbA6gcAxxQoSLDioXhIWqtEtKr_FFeySpTaSXm1vfR5druk0qg76KIKuvZF_UDUU5v61wQA-Xaz1_o6bdLctOlmuTh5-CgIS7Ep1aVJogwXFMQWmdE5nFKrV6nDbLtI1aCJ-nNv0JDseywVgG36btsKTPdh3rK7SAWcWuKmirJOWZyUqezBJCNKdZKeJVfeduqfL8tT_THNI8unk1zZ7FWHcHYjwr1uhnFoSoxQ")
	//log.Logger.Infow("Decoding access token", "claims", claims)

	//keycloak.Auth("5fe7cfad-4e6c-42a6-9915-23252953365c.8e29f75c-e2a9-4be3-aea4-8c8f49122d7d.18894bbc-7b12-416a-8d44-1353ce8eb483", "sdfsadfsdf")

	//isExpired := keycloak.IsTokenExpired("eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI1bGF4RjI0SG56RnRWcmEtQWs2WG1YY2JRV1BweEsxMnFWSnhqbmRiYmhNIn0.eyJleHAiOjE2OTkxMTkzNjcsImlhdCI6MTY5OTExOTA2NywiYXV0aF90aW1lIjoxNjk5MTE5MDUxLCJqdGkiOiI2YjliOGVlMy05YzdiLTQ2OTktOGUwMC0wMWUxNjk5MDZlYjUiLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvcmVhbG1zL2xvZ2ktY2xvdWQiLCJhdWQiOiJhY2NvdW50Iiwic3ViIjoiODY5YzZmN2QtYzdmYi00M2M5LTk4NWQtOTJiOGUyMTFlNDNmIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoic3NvLWFwcCIsInNlc3Npb25fc3RhdGUiOiI4ZTI5Zjc1Yy1lMmE5LTRiZTMtYWVhNC04YzhmNDkxMjJkN2QiLCJhY3IiOiIxIiwiYWxsb3dlZC1vcmlnaW5zIjpbIioiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwiZGVmYXVsdC1yb2xlcy1sb2dpLWNsb3VkIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX0sInNzby1hcHAiOnsicm9sZXMiOlsicm9sZS11c2VyIl19fSwic2NvcGUiOiJvcGVuaWQgZW1haWwgcHJvZmlsZSIsInNpZCI6IjhlMjlmNzVjLWUyYTktNGJlMy1hZWE0LThjOGY0OTEyMmQ3ZCIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoiU2hpaGFiIEhhc2FuIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2hpaGFiIiwiZ2l2ZW5fbmFtZSI6IlNoaWhhYiIsImZhbWlseV9uYW1lIjoiSGFzYW4iLCJlbWFpbCI6InNoaWhhYi5oYXNhbkBsb2dpLWNsb3VkLmNvbSJ9.U4zPdkW2ed1w_bvGF0W-qcWvv8__zWQ7kO0OIq_ahUrANk6GFHc7iCd41RaDQRsN-Om6yCJX01uuoZyKyrPBK0NU3kcFXshHQD6fGDmuE48Yn-Lg-ExmTfxU4Le01Vcuh38TQghghyGdFIAC11l5hmiXClpk-X_VTeosL5MObATSrmwfLk0MIHlsNO6kdTmylCTi0UUT4aMm9-KX5AZOlEgWarM2q79NO3yxiQI8aI0DnW4zpYD9l5ETzdypJWtnQnYU7Ai1u0KAgsSw7T7MLgt-hUDIpMbK39D4M1nEoYGoJM2cZLX4Rn21scdF3JPqshlQvydNhjqTAdctY2C4jA")
	//log.Logger.Infow("Token validity", "is_expired", isExpired)

	// Start Http Server
	server.Start()
}
